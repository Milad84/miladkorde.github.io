<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

 <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
   integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
   crossorigin=""/>

 <!-- Make sure you put this AFTER Leaflet's CSS -->

 <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
   integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
   crossorigin=""> </script>

   <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
   <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

<script src="javascript/TravisClusters.js"></script>

<style type="text/css">

    .info {
    padding: 6px 8px;
    font: 14px/16px Arial, Helvetica, sans-serif;
    background: white;
    background: rgba(255,255,255,0.8);
    box-shadow: 0 0 15px rgba(0,0,0,0.2);
    border-radius: 5px;
}
.info h4 {
    margin: 0 0 5px;
    color: #777;
}

.legend {
    line-height: 18px;
    color: #555;
}
.legend i {
    width: 18px;
    height: 18px;
    float: left;
    margin-right: 8px;
    opacity: 0.7;
}
  </style>

</head>
<h3> MEASURING LOCAL CONTEXT: USING MACHINE LEARNING AND K-MEANS CLUSTERING OF CONSUMER SURVEY DATA TO APPROXIMATE LOCAL ATTITUDES</h3>

<body>

<div id="mapid" style="width: 100%; height: 600px;"></div>

<script>

var map = L.map('mapid').setView([31.968599, -99.901810 ], 14);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
}).addTo(map);

var geojson = L.geoJson(TravisClusters).addTo(map);

//If you want your map to appear on the extent of the GeoJson:
map.fitBounds(geojson.getBounds())

/////////////////////////////////////////////////////////////////////////////
L.geoJson(TravisClusters).addTo(map);

//test if...else
// function getColor(d) {
//      if (d == 1)  { return'#036ffc'}
//      if (d == 2 )  { return '#fc032c'}
//      if (d == 3 )  {return'#67fc03' }
//
//
//     // else
//         // { return '#FFEDA0'}
//
//  }

function getColor(d) {
      if (d === 1 ) { return'#036ffc'}  + 'Cluster 1 (blue color) = Weakest support for environmental initiatives'
      if (d === 2 ) { return '#fc032c'}  + 'Cluster 2 (red color) = Strong support for environmental initiatives'
      if (d === 3 ) {return'#67fc03' } + 'Cluster 3 (green color) = Weaker support for environmental initiatives'

    }


function style(feature) {
    return {
        fillColor: getColor(feature.properties.CLUSTER_ID),
        weight: 0.2,
        opacity: 1,
        color: 'white',
        dashArray: '1',
        fillOpacity: 0.7
    };
}

L.geoJson(TravisClusters, {style: style}).addTo(map);

function highlightFeature(e) {
    var layer = e.target;

    layer.setStyle({
        weight: 5,
        color: '#666',
        dashArray: '',
        fillOpacity: 0.7



    });

    if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
        layer.bringToFront();

        info.update(layer.feature.properties);
    }

}

function resetHighlight(e) {
    geojson.resetStyle(e.target);
    info.update();
}



function zoomToFeature(e) {
    map.fitBounds(e.target.getBounds());
}
function onEachFeature(feature, layer) {
    layer.on({
        mouseover: highlightFeature,
        mouseout: resetHighlight,
        click: zoomToFeature
    });
}

geojson = L.geoJson(TravisClusters, {
    style: style,
    onEachFeature: onEachFeature
}).addTo(map);

var info = L.control();

info.onAdd = function (map) {
    this._div = L.DomUtil.create('div', 'info'); // create a div with a class "info"
    this.update();
    return this._div;
};

// method that we will use to update the control based on feature properties passed
info.update = function (props) {
    this._div.innerHTML = '<h4>Clusters of attitudes towards sustainability in Travis County, Texas </h4>' +  (props ?
        '<b>' + props.CLUSTER_ID + '</b><br />' + props.CLUSTER_ID + ' cluster number'
        : 'Hover over a Census block group to see the associated color and number');
};

info.addTo(map);

// var legend = L.control({position: 'bottomright'});
//
// legend.onAdd = function (map) {
//
//     var div = L.DomUtil.create('div', 'info legend'),
//         grades = [1,2,3],
//         labels = [];
//
//   //  loop through the items [1,2,3] and assign a color
//     for (var i = 0; i < grades.length; i++) {
//         div.innerHTML +=
//             '<i style="background:' + getColor(grades[i] + 1) + '"></i> ' +
//             grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] + '<br>' : '+');
//     }
//
//     return div;
// };
//
// legend.addTo(map);

var legend = L.control({position: 'bottomleft'});
    legend.onAdd = function (map) {

    var div = L.DomUtil.create('div', 'info legend');
    labels = ['<strong>Cluster Categories</strong>'],
    //categories = ['Cluster 1 (blue color) = Weakest support for environmental initiatives ','Cluster 2 (red color) = Strong support for environmental initiatives','Cluster 3 (green color) = Weaker support for environmental initiatives'];
      categories = [1,2,3]

    for (var i = 0; i < categories.length; i++) {

            div.innerHTML +=
            labels.push(
                '<i class="circle" style="background:' + getColor(categories[i]) + '"></i> ' +
            (categories[i] ? categories[i] : '+'));

        }
        div.innerHTML = labels.join('<br>');
    return div;
    };
    legend.addTo(map);
/////////////////////////////////////////////////////////////////////////////

</script>
<p>Cluster 1 (blue color) = Weakest support for environmental initiatives</p>
<p>Cluster 2 (red color) = Strong support for environmental initiatives</p>
<p>Cluster 3 (green color) = Weaker support for environmental initiatives </p>



<p>This study will attempt to situate concrete alternative energy projects at selected HEIs in their state and local/community contexts. Whereas the preceding sections of my study proposed data and methods for measuring/describing state context, this section provides details on how the local context will be approximated.
To assess the geographical context, I will rely on two valuable data sources: (1) the SimmonsLOCAL annual consumer survey and (2) America's Goals Report. The indicator sources were chosen to be as up-to-date as possible and based on data availability for the most significant number of States. The purpose of further analysis of geographical context is to represent the interests to which university decision-makers are accountable and in which they are embedded. The assumption is that university administrators make decisions consistent with state priorities, especially when they are state-owned and funded. Therefore, by looking at the extent of sustainability in public/state HEIs' plans, it is possible to assess whether current priorities reflect state policy.
Similarly, it is possible to draw on data from local (home) populations to determine how aligned HEI energy priorities are with their neighbors' attitudes towards the environment. In that sense, and drawing on the instructive literature summarized above, an HEI's commitment to sustainable energy is hypothesized to be a function of at least three interacting variables: (1) Financial feasibility (i.e., whether there is a proper coupling), (2) State priorities, and (3) Local priorities. One argument could be that universities are most likely to invest in sustainable energy when all three of the above factors are favorable (i.e., it is profitable; the state is strong on climate action and energy, and residents prioritize sustainability goals). On the other hand, even when projects are financially feasible, we might expect inaction if states and localities are not particularly strong on environmental protection sustainability issues.
"Mapping features based on how similar they are to surrounding features [clustering] is different [and more significant] than simply mapping the values of features [graduate color map]" (Mitchel, 2005, p.163). By comparing the geographical locations of clusters, it is possible to examine and identify the possible contributing factors to sustainability commitment in HEIs.
To perform a cluster analysis, two problems have to be solved: (1) efficient partitioning with homogeneous groups and (2) effective interpretation (Huang, 1997). The Multivariate Clustering tool in ArcGIS Pro uses the k-means algorithm by default. If the number of clusters is not defined, they will be determined by Calinski-Harabasz pseudo-F-statistics, a ratio of the variance between and within clusters. While it is possible to use nominal data, the variable used in K-means should be numeric because the algorithm does not yield satisfactory results with binary (categorical) variables (ArcGIS Pro help) unless a two-step approach is used. In addition to a summary statistic for each variable, the R2 will also be calculated (Equation 35).
The similarity between features is determined by the value assigned to them. In the k-means approach, higher values in multiple features will be associated with higher values in other features through a highly algorithmic process that cannot be summarized in a single formula (Peng, 2012). K-means clustering is a partitioning approach based on multiple rounds of iteration (Peng, 2012, p.111; MacQueen, 1967; Meyers et al., 2016). One requirement is that the number of clusters should be decided, and when the number of clusters is left empty, the algorithm may produce a high number of clusters even with one variable selected. </p>

<p>The process called k-means appears to provide partitions that are "reasonably efficient in the sense of within-class variance" (MacQueen 1967, p.1). The k-means clustering is agglomerative since observations are added to a cluster after completing a phase and is iterative since the next step is based on previous ones (Meyers et al., 2016). The exact appropriate number of clusters cannot be known in advance, even though some statisticians tried to examine strategies to calculate the correct number of clusters before
starting the iteration (Meyers et al., 2016). The number of clusters will be determined after several attempts and by comparison between the researcher's best results or by using the results of Pseudo F statistics (Peng, 2012; Meyers et al., 2016).
The k-means also represent a generalization of the ordinary sample mean (MacQueen, 1967). Given a set of numeric X and an integer number of clusters (K), the K-means algorithm tries to find a partition of X into K clusters that minimize the within-group sum of squared errors (WGSS) (Huang, 1998). To achieve that, the variables should be in z-score, the standardization of data should be applied before starting the algorithm (Meyers et al., 2016), and data should be screened for outliers to avoid their selection as the central point in the clustering step (Norusis, 2011; Shih et al., 2010). The outline of the algorithm is defined by Peng (2012), Meyers (2016), ArcGIS help center (2019), MacQueen (1967), Shih et al. (2010), Ralambondrainy (1995), Huang (1998), and Jain (2010) as follows:
1. Classification: identifies the number of clusters at some integer greater than or equal to 2.
2. Selection of a sample number of centroids (seeds): this step is also known as the seed point step, where some random points will be drawn as the center of clusters (see appendix 1).
3. Assigning the points (objects, values) to the centroids of features
4. Assign the center points of each feature to the belonging cluster: After a point is added, "the mean of the group will be adjusted to take account of the new point" (MacQueen, 1967, p.283).
5. Recalculation of centroid position and repetition of the iteration: The modified Centroid involves calculating the Euclidean distance between center points. The smallest distance then will determine which cluster the center point belongs to. One key criterion is "the minimum sum of squared Euclidean distances from each entity to the centroid of the cluster to which it belongs" (Aloise et al., 2009, p.245).
</p>

<p>The 15 variables used in this dissertation come from different data sets available on SimplyAnalytics, and they include people who agree with the following statements: (1) make a conscious effort to recycle, (2) packaging for products should be recycled, (3) environmentally sound/good business. (4) companies should help consumers to become environmentally responsible, (5) personal obligation towards environmental responsibility, (6) others must see me environmentally conscious, (7) would buy less expensive eco-friendly products,

(8) eco-friendly products should be of higher quality products, (9) tell companies to stop sending catalogs, (10) more likely to purchase from the environmentally-friendly company, (11) to choose environmentally-friendly methods of transportation, (12) they have used recycled products, (13) worried about the pollution caused by cars, (14) people have to recycle, and (15) people who belong to environmentalists organizations.
</p>


















</html>
